@page "/"

<div class="index">
    <h1>ROCK PAPER SCISSORS</h1>

    @switch(step)
    {
        case 1:
            <div class="menu 1">
                <button @onclick=@HostOnClick>Create Game</button>
                <button @onclick=@JoinOnClick>Join Game</button>
            </div>
            break;
        case 2:

            <div class="menu 2">
                <h5>Username:</h5>
                <InputText @bind-Value="username" class="input username" />
                
                @if(host)
                {
                    <button @onclick=@CreateRoom>Create</button>

                }
                else
                {
                    <h5>Room Code:</h5>
                    <InputText @bind-Value="roomCode" class="input roomcode" />
                    <button>Join</button>
                }
                <button @onclick=@BackOnClick>◄Go back</button>
            </div>
            break;
    }
</div>

@code {
    bool host = false;
    int step = 1;

    String username = String.Empty;
    String roomCode = String.Empty;
    String salt = String.Empty;


    protected override void OnInitialized()
    {
        salt = Environment.GetEnvironmentVariable("ROOMID_SALT");

        if(salt is null)
        {
            salt = "default";
        }
    }

    private void HostOnClick()
    {
        host = true;
        step = 2;
    }

    private void JoinOnClick()
    {
        host = false;
        step = 2;
    }

    private void BackOnClick()
    {
        host = false;
        step = 1;
    }

    private void CreateRoom()
    {
        roomCode = GenerateId();
        Console.WriteLine(roomCode);
    }

    private string GenerateId()
    {
        var guid = Guid.NewGuid();
        var guidBytes = guid.ToByteArray();
        return Convert.ToBase64String(guidBytes).Replace("=", "").Replace("+", "").Replace("/", "");
    }
}
