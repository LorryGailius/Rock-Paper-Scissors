@page "/"
@using System.Text;
@using Rock_Paper_Scissors.Client.Services;
@inject IUserService UserService;

<div class="index">
    <h1>ROCK PAPER SCISSORS</h1>

    @switch(step)
    {
        case 1:
            <div class="menu 1">
                <button @onclick=@HostOnClick>Create Game</button>
                <button @onclick=@JoinOnClick>Join Game</button>
            </div>
            break;
        case 2:

            <div class="menu 2">
                <h5>Username:</h5>
                <InputText @bind-Value="usernameField" class="input username" />
                
                @if(host)
                {
                    <button @onclick=@CreateRoom>Create</button>

                }
                else
                {
                    <h5>Room Code:</h5>
                    <InputText @bind-Value="roomCodeField" class="input roomcode" />
                    <button>Join</button>
                }
                <button @onclick=@BackOnClick style="position:absolute;bottom:0;">◄Go back</button>
            </div>
            break;
    }
</div>

@code {
    bool host = false;
    int step = 1;

    String usernameField = String.Empty;
    String roomCodeField = String.Empty;
    String salt = String.Empty;

    private void HostOnClick()
    {
        host = true;
        step = 2;
    }

    private void JoinOnClick()
    {
        host = false;
        step = 2;
    }

    private void BackOnClick()
    {
        host = false;
        step = 1;
    }

    private void CreateRoom()
    {
        if(usernameField == String.Empty)
        {
            Console.WriteLine("Username is empty");
            return;
        }
        UserService.Username = usernameField;
        roomCodeField = GenerateId(6);
        Console.WriteLine(roomCodeField);
    }

    private void JoinRoom()
    {
        if(usernameField == String.Empty)
        {
            Console.WriteLine("Username is empty");
            return;
        }
    }

    private string GenerateId(int length)
    {
        String availableChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        Random random = new Random();
        StringBuilder builder = new StringBuilder(length);

        for (int i = 0; i < length; i++)
        {
            builder.Append(availableChars[random.Next(availableChars.Length)]);
        }

        return builder.ToString();
    }
}
